<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spurs Tickets | Live Oversikt</title>
    <style>
        :root {
            --thfc-blue: #132257;
            --thfc-silver: #f3f3f3;
            --white: #ffffff;
            --accent-gold: #b39454;
            --warning-red: #d32f2f;
            --reserved-orange: #f39c12;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: var(--thfc-silver); margin: 0; padding: 0; color: #333; }
        header { background-color: var(--thfc-blue); color: white; padding: 2rem 1rem; text-align: center; border-bottom: 5px solid var(--accent-gold); }
        .container { max-width: 800px; margin: 2rem auto; padding: 0 1rem; }

        #availability-summary { background: var(--white); padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 1.5rem; border: 1px solid #ddd; font-weight: bold; color: var(--thfc-blue); }

        .view-images { display: flex; gap: 15px; justify-content: center; margin-bottom: 2rem; }
        .view-card { background: white; padding: 8px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; width: 140px; cursor: pointer; transition: transform 0.2s; }
        .view-card:hover { transform: scale(1.05); }
        .view-card img { width: 100%; height: 100px; object-fit: cover; border-radius: 4px; display: block; margin-bottom: 5px; background: #ccc; }
        .view-card small { font-size: 0.75rem; color: #555; display: block; line-height: 1.2; }

        #lightbox { display: none; position: fixed; z-index: 1000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); justify-content: center; align-items: center; cursor: pointer; }
        #lightbox img { max-width: 90%; max-height: 80%; border: 3px solid white; border-radius: 4px; }

        .terms-box { background: #fff; border: 2px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; }
        .terms-box h2 { color: var(--thfc-blue); margin-top: 0; font-size: 1.4rem; }
        .terms-box ul { padding-left: 20px; margin-bottom: 15px; }
        .highlight-text { font-weight: bold; color: var(--warning-red); }
        .footnote { font-size: 0.85rem; color: #666; border-top: 1px solid #eee; padding-top: 10px; margin-top: 10px; font-style: italic; }
        .btn-membership { display: inline-block; background: var(--thfc-blue); color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; font-weight: bold; }

        .match-card { display: none; background: white; margin-bottom: 20px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-left: 6px solid var(--thfc-blue); }
        .match-card.visible { display: block; }
        .match-info { padding: 12px 20px; background: #f8f8f8; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
        .match-info h3 { margin: 0; font-size: 1.1rem; }
        
        table { width: 100%; border-collapse: collapse; }
        td { padding: 12px 20px; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        .price { font-weight: 800; color: var(--thfc-blue); }
        
        .status-badge { font-size: 0.7rem; font-weight: bold; padding: 4px 10px; border-radius: 4px; text-transform: uppercase; }
        .status-ledig { background: #e8f5e9; color: #28a745; }
        .status-solgt { background: #ffebee; color: #d32f2f; text-decoration: line-through; opacity: 0.6; }
        .status-reservert { background: #fff3e0; color: var(--reserved-orange); }

        .load-more-container { text-align: center; margin: 30px 0; }
        .btn-load { background: var(--thfc-blue); color: white; border: none; padding: 12px 40px; font-size: 1rem; font-weight: bold; border-radius: 50px; cursor: pointer; display: none; }

        .contact-box { background: white; padding: 2rem; text-align: center; border-radius: 12px; margin-top: 2rem; border: 1px solid #ddd; }
        .btn-contact { display: inline-block; padding: 12px 25px; margin: 5px; text-decoration: none; border-radius: 6px; font-weight: bold; color: white; }
        .messenger { background: #0084ff; }
        .twitter { background: #000; }
        
        footer { text-align: center; padding: 3rem; color: #888; font-size: 0.8rem; }
    </style>
</head>
<body>

<header>
    <h1>Tottenham Hotspur Tickets</h1>
    <p>Live Billettoversikt 2025/2026</p>
</header>

<div id="lightbox" onclick="this.style.display='none'"><img src="" id="lightbox-img"></div>

<div class="container">
    <div id="availability-summary">Sjekker status på billetter...</div>

    <div class="view-images">
        <div class="view-card" onclick="openLightbox('256.jpg')">
            <img src="256.jpg" alt="Utsikt Area 256">
            <small>Area 256<br><strong>Row 5</strong></small>
        </div>
        <div class="view-card" onclick="openLightbox('451.jpg')">
            <img src="451.jpg" alt="Utsikt Area 451">
            <small>Area 451<br><strong>Row 68</strong></small>
        </div>
    </div>

    <div class="terms-box">
        <h2>Viktig informasjon & vilkår</h2>
        <ul>
            <li><strong>Krav om medlemskap:</strong> Alle som skal ha billett må være <strong>One Hotspur medlem</strong>.</li>
            <li><strong>Januar-salg:</strong> Vanligvis £45 pr. sesong, men <span class="highlight-text">nå på 50% rabatt!</span> (£22.50).</li>
            <li><strong>Overføring:</strong> Jeg trenger <strong>fullt navn</strong> og <strong>CRN*</strong> for hver billett.</li>
        </ul>
        <a href="https://www.tottenhamhotspur.com/fans/membership/one-hotspur/" target="_blank" class="btn-membership">Kjøp medlemskap her →</a>
        <div class="footnote">*CRN (Client Reference Number): Ditt unike kundenummer fra klubben.</div>
    </div>

    <div id="loading">Henter oppdatert kampprogram...</div>
    <div id="tickets-container"></div>

    <div class="load-more-container">
        <button id="loadMore" class="btn-load">Se flere kamper</button>
    </div>

    <div class="contact-box">
        <h3>Interessert i billetter?</h3>
        <a href="https://m.me/DITT_BRUKERNAVN" class="btn-contact messenger">Messenger</a>
        <a href="https://twitter.com/DITT_BRUKERNAVN" class="btn-contact twitter">Twitter / X</a>
    </div>
</div>

<footer><p>COYS | Automatisk prisoppdatering</p></footer>

<script>
    const SPREADSHEET_ID = '1vFUgq4p-UM6v6zPMHx1sshZunqC-We3VVYb0H_rhIhM'; 
    const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json`;

    let currentVisible = 4;
    let matchBlocks = [];
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    function openLightbox(src) {
        document.getElementById('lightbox-img').src = src;
        document.getElementById('lightbox').style.display = 'flex';
    }

    // Funksjon for å runde OPP til nærmeste 50
    function roundUpTo50(value) {
        // Fjerner alt som ikke er tall (f.eks "kr", ",-", mellomrom)
        let num = parseFloat(value.toString().replace(/[^\d.]/g, ''));
        if (isNaN(num)) return value; // Returner original tekst hvis det ikke er et tall
        return Math.ceil(num / 50) * 50;
    }

    fetch(url)
        .then(res => res.text())
        .then(data => {
            const json = JSON.parse(data.substr(47).slice(0, -2));
            const rows = json.table.rows;
            const container = document.getElementById('tickets-container');
            const summary = document.getElementById('availability-summary');
            document.getElementById('loading').style.display = 'none';

            let currentMatchName = "";
            let html = "";
            let totalAvailable = 0;

            rows.forEach((row, index) => {
                const kamp = row.c[0] ? (row.c[0].f || row.c[0].v) : "";
                if (kamp === "Kamp" || !kamp) return; 

                const rawDate = row.c[1] ? row.c[1].v : "";
                let matchDate = null;
                if (typeof rawDate === 'string' && rawDate.includes('Date')) {
                    matchDate = new Date(eval("new " + rawDate));
                } else {
                    matchDate = new Date(rawDate);
                }

                if (matchDate && matchDate < today) return;

                const datoVisning = row.c[1] ? (row.c[1].f || row.c[1].v) : "";
                const sete = row.c[2] ? (row.c[2].f || row.c[2].v) : "";
                const rawPris = row.c[3] ? (row.c[3].f || row.c[3].v) : "0";
                const status = row.c[4] ? (row.c[4].f || row.c[4].v) : "Ledig";

                // Bruker avrundingsfunksjonen på prisen
                const pris = roundUpTo50(rawPris);

                if (status.toLowerCase().includes('ledig')) totalAvailable++;

                if (kamp !== currentMatchName) {
                    if (currentMatchName !== "") html += `</table></div>`;
                    currentMatchName = kamp;
                    html += `<div class="match-card"><div class="match-info"><h3>vs ${kamp}</h3> <span>${datoVisning}</span></div><table>`;
                }

                let statusClass = "status-ledig";
                if (status.toLowerCase().includes('solgt')) statusClass = "status-solgt";
                if (status.toLowerCase().includes('reservert')) statusClass = "status-reservert";
                
                html += `<tr><td>${sete}</td><td class="price">${pris},-</td><td><span class="status-badge ${statusClass}">${status}</span></td></tr>`;
            });

            html += `</table></div>`;
            container.innerHTML = html;
            summary.innerHTML = `Status: ${totalAvailable} ledige billetter tilgjengelig`;

            matchBlocks = [...document.querySelectorAll('.match-card')];
            showNextMatches();
            if (matchBlocks.length > currentVisible) document.getElementById('loadMore').style.display = 'inline-block';
        });

    function showNextMatches() {
        for (let i = 0; i < currentVisible; i++) {
            if (matchBlocks[i]) matchBlocks[i].classList.add('visible');
        }
    }

    document.getElementById('loadMore').addEventListener('click', function() {
        const nextLimit = currentVisible + 4;
        for (let i = currentVisible; i < nextLimit; i++) {
            if (matchBlocks[i]) matchBlocks[i].classList.add('visible');
        }
        currentVisible = nextLimit;
        if (currentVisible >= matchBlocks.length) this.style.display = 'none';
    });
</script>
</body>
</html>