<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spurs Tickets | Live Oversikt</title>
    <style>
        :root {
            --thfc-blue: #132257;
            --thfc-silver: #f3f3f3;
            --white: #ffffff;
            --accent-gold: #b39454;
            --warning-red: #d32f2f;
            --reserved-orange: #f39c12;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: var(--thfc-silver); margin: 0; padding: 0; color: #333; }
        header { background-color: var(--thfc-blue); color: white; padding: 2rem 1rem; text-align: center; border-bottom: 5px solid var(--accent-gold); }
        .container { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }

        #availability-summary { background: var(--white); padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 2rem; border: 1px solid #ddd; font-weight: bold; color: var(--thfc-blue); }

        .view-images { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 2rem; }
        .view-card { background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
        .view-card img { width: 100%; height: auto; border-radius: 4px; display: block; margin-bottom: 10px; background: #ccc; }

        .terms-box { background: #fff; border: 2px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; }
        .terms-box h2 { color: var(--thfc-blue); margin-top: 0; font-size: 1.4rem; }
        .footnote { font-size: 0.85rem; color: #666; border-top: 1px solid #eee; padding-top: 10px; margin-top: 15px; font-style: italic; }
        .btn-membership { display: inline-block; background: var(--thfc-blue); color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; font-weight: bold; margin-top: 10px; }

        .match-card { display: none; background: white; margin-bottom: 25px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-left: 6px solid var(--thfc-blue); }
        .match-card.visible { display: block; }
        .match-info { padding: 15px 20px; background: #f8f8f8; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
        
        table { width: 100%; border-collapse: collapse; }
        td { padding: 15px 20px; border-bottom: 1px solid #eee; }
        .price { font-weight: 800; font-size: 1.1rem; }
        
        .status-badge { font-size: 0.75rem; font-weight: bold; padding: 5px 12px; border-radius: 4px; text-transform: uppercase; }
        .status-ledig { background: #e8f5e9; color: #28a745; }
        .status-solgt { background: #ffebee; color: #d32f2f; text-decoration: line-through; opacity: 0.6; }
        .status-reservert { background: #fff3e0; color: var(--reserved-orange); }

        .load-more-container { text-align: center; margin: 30px 0; }
        .btn-load { background: var(--thfc-blue); color: white; border: none; padding: 15px 45px; font-size: 1rem; font-weight: bold; border-radius: 50px; cursor: pointer; display: none; }

        #loading { text-align: center; padding: 40px; font-style: italic; color: #666; }
        .contact-box { background: white; padding: 2.5rem; text-align: center; border-radius: 12px; margin-top: 3rem; border: 1px solid #ddd; }
        .btn-contact { display: inline-block; padding: 14px 28px; margin: 8px; text-decoration: none; border-radius: 6px; font-weight: bold; color: white; }
        .messenger { background: #0084ff; }
        .twitter { background: #000; }
        
        footer { text-align: center; padding: 3rem; color: #888; font-size: 0.85rem; }
    </style>
</head>
<body>

<header>
    <h1>Tottenham Hotspur Tickets</h1>
    <p>Live Billettoversikt 2025/2026</p>
</header>

<div class="container">
    <div id="availability-summary">Oppdaterer ledige plasser...</div>

    <div class="view-images">
        <div class="view-card"><img src="256.jpg" alt="Utsikt Area 256"><small>Utsikt fra Area 256</small></div>
        <div class="view-card"><img src="451.jpg" alt="Utsikt Area 451"><small>Utsikt fra Area 451</small></div>
    </div>

    <div class="terms-box">
        <h2>Viktig informasjon & vilkår</h2>
        <ul>
            <li><strong>Medlemskap:</strong> Alle må ha aktivt <strong>One Hotspur Medlemskap</strong>.</li>
            <li><strong>Info:</strong> Jeg trenger fullt navn og <strong>CRN*</strong> for overføring.</li>
        </ul>
        <div class="footnote">*CRN: Ditt kundenummer fra klubben.</div>
        <a href="https://www.tottenhamhotspur.com/fans/membership/one-hotspur/" target="_blank" class="btn-membership">Kjøp medlemskap her →</a>
    </div>

    <div id="loading">Sjekker kampprogram...</div>
    <div id="tickets-container"></div>

    <div class="load-more-container">
        <button id="loadMore" class="btn-load">Se flere kamper</button>
    </div>

    <div class="contact-box">
        <h3>Kontakt for kjøp:</h3>
        <a href="https://m.me/DITT_BRUKERNAVN" class="btn-contact messenger">Messenger</a>
        <a href="https://twitter.com/DITT_BRUKERNAVN" class="btn-contact twitter">Twitter / X</a>
    </div>
</div>

<footer><p>COYS | Automatisert oversikt</p></footer>

<script>
    const SPREADSHEET_ID = '1vFUgq4p-UM6v6zPMHx1sshZunqC-We3VVYb0H_rhIhM'; 
    const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json`;

    let currentVisible = 4;
    let matchBlocks = [];
    const today = new Date();
    today.setHours(0, 0, 0, 0); // Nullstiller klokkeslett for nøyaktig datosjekk

    fetch(url)
        .then(res => res.text())
        .then(data => {
            const json = JSON.parse(data.substr(47).slice(0, -2));
            const rows = json.table.rows;
            const container = document.getElementById('tickets-container');
            const summary = document.getElementById('availability-summary');
            document.getElementById('loading').style.display = 'none';

            let currentMatchName = "";
            let html = "";
            let totalAvailable = 0;

            rows.forEach((row, index) => {
                const kamp = row.c[0] ? (row.c[0].f || row.c[0].v) : "";
                if (kamp === "Kamp" || !kamp) return; 

                // Dato-sjekk for automatisk skjuling
                const rawDate = row.c[1] ? row.c[1].v : "";
                let matchDate = null;
                
                // Forsøker å tolke datoen fra Google Sheets
                if (typeof rawDate === 'string' && rawDate.includes('Date')) {
                    matchDate = new Date(eval("new " + rawDate));
                } else {
                    matchDate = new Date(rawDate);
                }

                // HVIS kampen var i går eller tidligere -> hopp over
                if (matchDate && matchDate < today) return;

                const datoVisning = row.c[1] ? (row.c[1].f || row.c[1].v) : "";
                const sete = row.c[2] ? (row.c[2].f || row.c[2].v) : "";
                const pris = row.c[3] ? (row.c[3].f || row.c[3].v) : "0";
                const status = row.c[4] ? (row.c[4].f || row.c[4].v) : "Ledig";

                if (status.toLowerCase().includes('ledig')) totalAvailable++;

                if (kamp !== currentMatchName) {
                    if (currentMatchName !== "") html += `</table></div>`;
                    currentMatchName = kamp;
                    html += `<div class="match-card"><div class="match-info"><h3>vs ${kamp}</h3> <span>${datoVisning}</span></div><table>`;
                }

                let statusClass = "status-ledig";
                if (status.toLowerCase().includes('solgt')) statusClass = "status-solgt";
                if (status.toLowerCase().includes('reservert')) statusClass = "status-reservert";
                
                html += `<tr><td>${sete}</td><td class="price">${pris},-</td><td><span class="status-badge ${statusClass}">${status}</span></td></tr>`;
            });

            html += `</table></div>`;
            container.innerHTML = html;
            summary.innerHTML = `Akkurat nå: ${totalAvailable} ledige billetter ute for salg`;

            matchBlocks = [...document.querySelectorAll('.match-card')];
            showNextMatches();
            if (matchBlocks.length > currentVisible) document.getElementById('loadMore').style.display = 'inline-block';
        });

    function showNextMatches() {
        for (let i = 0; i < currentVisible; i++) {
            if (matchBlocks[i]) matchBlocks[i].classList.add('visible');
        }
    }

    document.getElementById('loadMore').addEventListener('click', function() {
        const nextLimit = currentVisible + 4;
        for (let i = currentVisible; i < nextLimit; i++) {
            if (matchBlocks[i]) matchBlocks[i].classList.add('visible');
        }
        currentVisible = nextLimit;
        if (currentVisible >= matchBlocks.length) this.style.display = 'none';
    });
</script>
</body>
</html>